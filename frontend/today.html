<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šæ—¥ä½œä¸š - å¢¨å®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/today.css">
</head>
<body class="bg-amber-50 min-h-screen">
    <!-- Toast æç¤º -->
    <div id="toast" class="toast hidden">åŠ è½½ä¸­...</div>

    <!-- å®Œæˆæ¨ªå¹… -->
    <div id="completionBanner" class="completion-banner hidden">
        <div class="banner-content">
            <span class="banner-icon">ğŸ‰</span>
            <span class="banner-text">æ‰€æœ‰ä½œä¸šéƒ½å†™å®Œå•¦ï¼</span>
            <button id="completionConfirmBtn" class="banner-confirm-btn">å»ç©å’¯</button>
            <button id="completionCloseBtn" class="banner-close-btn">&times;</button>
        </div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div id="app">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="top-nav">
            <a href="registry.html" class="back-button">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </a>
            <h1 id="batchName" class="page-title">åŠ è½½ä¸­...</h1>
            <div class="w-8"></div>
        </div>

        <!-- å¤§å›¾åŒºåŸŸ -->
        <div id="imagesContainer" class="images-container hidden">
            <div id="imagesList" class="images-list">
                <!-- å›¾ç‰‡ç”± JS å¡«å…… -->
            </div>
        </div>

        <!-- Deadline å€’è®¡æ—¶ -->
        <div id="deadlineContainer" class="deadline-container hidden">
            <!-- ç”± JS å¡«å…… -->
        </div>

        <!-- ä½œä¸šåˆ—è¡¨ -->
        <div class="items-container">
            <div id="todoItems" class="items-list">
                <!-- æœªå®Œæˆä½œä¸š -->
            </div>
            <div id="doneSection" class="done-section hidden">
                <div class="done-divider">
                    <span>å·²å®Œæˆ</span>
                </div>
                <div id="doneItems" class="items-list">
                    <!-- å·²å®Œæˆä½œä¸š -->
                </div>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡æŸ¥çœ‹å™¨å¼¹çª— -->
    <div id="imageViewer" class="image-viewer hidden">
        <button id="imageViewerClose" class="viewer-close">&times;</button>
        <button id="imageViewerPrev" class="viewer-nav viewer-prev">&#10094;</button>
        <img id="imageViewerImg" class="viewer-image" src="" alt="">
        <button id="imageViewerNext" class="viewer-nav viewer-next">&#10095;</button>
    </div>

    <!-- å®Œæˆç¡®è®¤å¼¹çª— -->
    <div id="completionModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-icon">ğŸ‰</div>
            <h2 class="modal-title">å¤ªæ£’äº†ï¼</h2>
            <p class="modal-text">æ‰€æœ‰ä½œä¸šéƒ½å®Œæˆäº†</p>
            <div class="modal-actions">
                <button id="completionCancel" class="modal-btn modal-btn-secondary">æˆ‘å†çœ‹çœ‹æœ‰æ²¡æœ‰æ¼ä½œä¸š</button>
                <button id="completionConfirm" class="modal-btn modal-btn-primary">å»ç©å’¯</button>
            </div>
        </div>
    </div>

    <script>
        // åŠ¨æ€è®¾ç½®è„šæœ¬åŸºç¡€è·¯å¾„ï¼ˆæ”¯æŒå­è·¯å¾„éƒ¨ç½²ï¼‰
        const SCRIPT_BASE = (function() {
            const path = window.location.pathname;
            const match = path.match(/^(\/[^/]+)\//);
            return match ? match[1] : '';
        })();
    </script>
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/today.js"></script>
    <script>
        // é¡µé¢åˆå§‹åŒ–ï¼šä» URL è·å– batchId
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const batchId = params.get('id');

            if (!batchId) {
                // æ²¡æœ‰ batchIdï¼Œè·³è½¬å›ç™»è®°ç°¿
                const base = SCRIPT_BASE || '';
                window.location.href = `${base}/registry.html`;
                return;
            }

            // åŠ è½½ä»Šæ—¥ä½œä¸šæ•°æ®
            if (typeof loadTodayPage === 'function') {
                await loadTodayPage(batchId);
            }
        });
    </script>
</body>
</html>
