<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œä¸šç™»è®°ç°¿ - å¢¨å®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/frontend/css/common.css">
    <link rel="stylesheet" href="/frontend/css/registry.css">
    <link rel="stylesheet" href="/frontend/css/editor.css">
</head>
<body class="bg-amber-50 min-h-screen">
    <!-- Toast æç¤º -->
    <div id="toast" class="toast hidden">åŠ è½½ä¸­...</div>

    <!-- Loading é®ç½© -->
    <div id="loading" class="hidden">
        <div class="loading-content">
            <div class="loading-dots">
                <span class="loading-dot"></span>
                <span class="loading-dot"></span>
                <span class="loading-dot"></span>
            </div>
            <p class="loading-text">åŠ è½½ä¸­...</p>
        </div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div id="app">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="page-header">
            <h1 class="page-title">ä½œä¸šç™»è®°ç°¿</h1>
        </div>

        <!-- ä¹¦æœ¬ç½‘æ ¼ -->
        <div id="batchesGrid" class="batches-grid">
            <!-- ç”± JS å¡«å…… -->
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div id="emptyState" class="empty-state hidden">
            <div class="empty-icon">ğŸ“š</div>
            <p class="empty-text">è¿˜æ²¡æœ‰ä½œä¸š</p>
        </div>
    </div>

    <!-- å›¾ç‰‡ä¸Šä¼ å¼¹çª— -->
    <div id="uploadModal" class="modal-overlay hidden">
        <div class="upload-modal">
            <div class="upload-header">
                <h3 class="upload-title">ä¸Šä¼ ä½œä¸šå›¾ç‰‡</h3>
                <button id="uploadClose" class="upload-close">&times;</button>
            </div>
            <div class="upload-body">
                <button id="cameraBtn" class="upload-btn">
                    <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span>æ‹ç…§</span>
                </button>
                <button id="galleryBtn" class="upload-btn">
                    <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>ä»ç›¸å†Œé€‰æ‹©</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘å™¨å¼¹çª— -->
    <div id="editorModal" class="hidden">
        <div id="editorHeader">
            <span id="editorTitle">ç¼–è¾‘ä½œä¸š</span>
        </div>
        <div id="editorContent">
            <!-- å›¾ç‰‡åŒºåŸŸ -->
            <div>
                <div class="editor-section-title">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>ä½œä¸šå›¾ç‰‡</span>
                </div>
                <div id="editorImagesList"></div>
            </div>
            <!-- ä½œä¸šé¡¹åŒºåŸŸ -->
            <div>
                <div class="editor-section-title">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    <span>ä½œä¸šåˆ—è¡¨</span>
                </div>
                <div id="editorItemsList"></div>
                <button id="editorAddItemBtn">+ æ·»åŠ ä½œä¸š</button>
            </div>
            <!-- æˆªæ­¢æ—¶é—´ -->
            <div id="editorDeadlineWrapper">
                <label id="editorDeadlineLabel" for="editorDeadlineInput">æˆªæ­¢æ—¶é—´</label>
                <input id="editorDeadlineInput" type="datetime-local">
                <svg id="editorDeadlineIcon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
        </div>
        <!-- åº•éƒ¨æ“ä½œæ  -->
        <div id="editorFooter">
            <button id="editorCancelBtn" class="editor-footer-btn editor-footer-btn-secondary">å–æ¶ˆ</button>
            <button id="editorSaveBtn" class="editor-footer-btn editor-footer-btn-primary">ä¿å­˜</button>
        </div>
    </div>

    <!-- å›¾ç‰‡ä¸Šä¼ å¼¹çª— -->
    <div id="editorUploadModal" class="hidden">
        <div id="editorUploadContent">
            <div id="editorUploadHeader">
                <span id="editorUploadTitle">ä¸Šä¼ å›¾ç‰‡</span>
                <button id="editorUploadClose">&times;</button>
            </div>
            <div id="editorUploadBody">
                <!-- æ‹–æ‹½/ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ -->
                <div id="editorDropZone" class="editor-drop-zone">
                    <svg class="editor-drop-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="editor-drop-text">æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ</p>
                    <p class="editor-drop-subtext">æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <input type="file" id="editorFileInput" multiple accept="image/*" hidden>
                </div>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡æŸ¥çœ‹å™¨å¼¹çª— -->
    <div id="editorImageViewer" class="image-viewer hidden">
        <button class="viewer-close" onclick="editorCloseImageViewer()">&times;</button>
        <button class="viewer-nav viewer-prev" onclick="editorPrevImage()">&#10094;</button>
        <img class="viewer-image" src="" alt="">
        <button class="viewer-nav viewer-next" onclick="editorNextImage()">&#10095;</button>
    </div>

    <script src="/frontend/js/api.js"></script>
    <script src="/frontend/js/utils.js"></script>
    <script src="/frontend/js/editor.js"></script>
    <script src="/frontend/js/registry.js"></script>
    <script>
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            // å…ˆæ£€æŸ¥ URL å‚æ•°ï¼Œå¦‚æœæœ‰ edit å‚æ•°åˆ™åªæ‰“å¼€ç¼–è¾‘å™¨ï¼ˆä¸æ¸²æŸ“åˆ—è¡¨ï¼Œé¿å…é—ªçƒï¼‰
            const params = new URLSearchParams(window.location.search);
            const editBatchId = params.get('edit');

            if (editBatchId) {
                // ç¼–è¾‘å™¨æ¨¡å¼ï¼šä¸åŠ è½½ä¹¦æœ¬åˆ—è¡¨ï¼Œç›´æ¥æ‰“å¼€ç¼–è¾‘å™¨
                setTimeout(async () => {
                    if (typeof editorView !== 'undefined') {
                        await editorView.open('edit', parseInt(editBatchId));
                    }
                }, 100);
            } else {
                // æ­£å¸¸æ¨¡å¼ï¼šåŠ è½½ç™»è®°ç°¿é¡µé¢
                if (typeof loadRegistryPage === 'function') {
                    await loadRegistryPage();
                }
            }
        });
    </script>
</body>
</html>
