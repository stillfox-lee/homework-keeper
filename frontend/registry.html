<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作业登记簿 - 墨宝</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/frontend/css/common.css">
    <link rel="stylesheet" href="/frontend/css/registry.css">
    <link rel="stylesheet" href="/frontend/css/editor.css">
</head>
<body class="bg-amber-50 min-h-screen">
    <!-- Toast 提示 -->
    <div id="toast" class="toast hidden">加载中...</div>

    <!-- 主容器 -->
    <div id="app">
        <!-- 顶部标题 -->
        <div class="page-header">
            <h1 class="page-title">作业登记簿</h1>
        </div>

        <!-- 书本网格 -->
        <div id="batchesGrid" class="batches-grid">
            <!-- 由 JS 填充 -->
        </div>

        <!-- 空状态 -->
        <div id="emptyState" class="empty-state hidden">
            <div class="empty-icon">📚</div>
            <p class="empty-text">还没有作业</p>
            <p class="empty-hint">点击下方按钮添加新的作业</p>
        </div>
    </div>

    <!-- 图片上传弹窗 -->
    <div id="uploadModal" class="modal-overlay hidden">
        <div class="upload-modal">
            <div class="upload-header">
                <h3 class="upload-title">上传作业图片</h3>
                <button id="uploadClose" class="upload-close">&times;</button>
            </div>
            <div class="upload-body">
                <button id="cameraBtn" class="upload-btn">
                    <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span>拍照</span>
                </button>
                <button id="galleryBtn" class="upload-btn">
                    <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>从相册选择</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 编辑器弹窗 -->
    <div id="editorModal" class="hidden">
        <div id="editorHeader">
            <span id="editorTitle">编辑作业</span>
        </div>
        <div id="editorContent">
            <!-- 图片区域 -->
            <div>
                <div class="editor-section-title">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>作业图片</span>
                </div>
                <div id="editorImagesList"></div>
            </div>
            <!-- 作业项区域 -->
            <div>
                <div class="editor-section-title">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    <span>作业列表</span>
                </div>
                <div id="editorItemsList"></div>
                <button id="editorAddItemBtn">+ 添加作业</button>
            </div>
            <!-- 截止时间 -->
            <div id="editorDeadlineWrapper">
                <label id="editorDeadlineLabel" for="editorDeadlineInput">截止时间</label>
                <input id="editorDeadlineInput" type="datetime-local">
                <svg id="editorDeadlineIcon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
        </div>
        <!-- 底部操作栏 -->
        <div id="editorFooter">
            <button id="editorCancelBtn" class="editor-footer-btn editor-footer-btn-secondary">取消</button>
            <button id="editorSaveBtn" class="editor-footer-btn editor-footer-btn-primary">保存</button>
        </div>
    </div>

    <!-- 图片上传弹窗 -->
    <div id="editorUploadModal" class="hidden">
        <div id="editorUploadContent">
            <div id="editorUploadHeader">
                <span id="editorUploadTitle">上传图片</span>
                <button id="editorUploadClose">&times;</button>
            </div>
            <div id="editorUploadBody">
                <!-- 拖拽/点击上传区域 -->
                <div id="editorDropZone" class="editor-drop-zone">
                    <svg class="editor-drop-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="editor-drop-text">拖拽图片到这里</p>
                    <p class="editor-drop-subtext">或点击选择文件</p>
                    <input type="file" id="editorFileInput" multiple accept="image/*" hidden>
                </div>
            </div>
        </div>
    </div>

    <!-- 图片查看器弹窗 -->
    <div id="editorImageViewer" class="image-viewer hidden">
        <button class="viewer-close" onclick="editorCloseImageViewer()">&times;</button>
        <button class="viewer-nav viewer-prev" onclick="editorPrevImage()">&#10094;</button>
        <img class="viewer-image" src="" alt="">
        <button class="viewer-nav viewer-next" onclick="editorNextImage()">&#10095;</button>
    </div>

    <script src="/frontend/js/api.js"></script>
    <script src="/frontend/js/utils.js"></script>
    <script src="/frontend/js/editor.js"></script>
    <script src="/frontend/js/registry.js"></script>
    <script>
        // 页面初始化
        document.addEventListener('DOMContentLoaded', async () => {
            // 先检查 URL 参数，如果有 edit 参数则只打开编辑器（不渲染列表，避免闪烁）
            const params = new URLSearchParams(window.location.search);
            const editBatchId = params.get('edit');

            if (editBatchId) {
                // 编辑器模式：不加载书本列表，直接打开编辑器
                setTimeout(async () => {
                    if (typeof editorView !== 'undefined') {
                        await editorView.open('edit', parseInt(editBatchId));
                    }
                }, 100);
            } else {
                // 正常模式：加载登记簿页面
                if (typeof loadRegistryPage === 'function') {
                    await loadRegistryPage();
                }
            }
        });
    </script>
</body>
</html>
