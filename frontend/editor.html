<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="./frontend/favicon.svg">
    <title>编辑作业 - 墨宝</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./frontend/css/common.css">
    <link rel="stylesheet" href="./frontend/css/editor.css">
</head>
<body class="bg-amber-50 min-h-screen">
    <!-- Toast 提示 -->
    <div id="toast" class="toast hidden">加载中...</div>

    <!-- Loading 遮罩 -->
    <div id="loading" class="hidden">
        <div class="loading-content">
            <div class="loading-dots">
                <span class="loading-dot"></span>
                <span class="loading-dot"></span>
                <span class="loading-dot"></span>
            </div>
            <p class="loading-text">加载中...</p>
        </div>
    </div>

    <!-- 编辑器页面容器 -->
    <div id="editorContainer">
        <!-- 顶部标题栏 -->
        <div id="editorHeader">
            <span id="editorTitle">编辑作业</span>
        </div>

        <!-- 编辑内容区域 -->
        <div id="editorContent">
            <!-- 图片区域 -->
            <div>
                <div class="editor-section-title">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>作业图片</span>
                </div>
                <div id="editorImagesList"></div>
            </div>
            <!-- 作业项区域 -->
            <div>
                <div class="editor-section-title">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    <span>作业列表</span>
                </div>
                <div id="editorItemsList"></div>
                <button id="editorAddItemBtn">+ 添加作业</button>
            </div>
            <!-- 截止时间 -->
            <div id="editorDeadlineWrapper">
                <label id="editorDeadlineLabel" for="editorDeadlineInput">截止时间</label>
                <input id="editorDeadlineInput" type="datetime-local">
                <svg id="editorDeadlineIcon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
        </div>

        <!-- 底部操作栏 -->
        <div id="editorFooter">
            <button id="editorCancelBtn" class="editor-footer-btn editor-footer-btn-secondary">返回作业登记簿</button>
            <button id="editorSaveBtn" class="editor-footer-btn editor-footer-btn-primary">保存</button>
        </div>
    </div>

    <!-- 图片上传弹窗 -->
    <div id="editorUploadModal" class="hidden">
        <div id="editorUploadContent">
            <div id="editorUploadHeader">
                <span id="editorUploadTitle">上传图片</span>
                <button id="editorUploadClose">&times;</button>
            </div>
            <div id="editorUploadBody">
                <!-- 拖拽/点击上传区域 -->
                <div id="editorDropZone" class="editor-drop-zone">
                    <svg class="editor-drop-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="editor-drop-text">拖拽图片到这里</p>
                    <p class="editor-drop-subtext">或点击选择文件</p>
                    <input type="file" id="editorFileInput" multiple accept="image/*" hidden>
                </div>
            </div>
        </div>
    </div>

    <!-- 图片查看器弹窗 -->
    <div id="editorImageViewer" class="image-viewer hidden">
        <button class="viewer-close" onclick="editorCloseImageViewer()">&times;</button>
        <button class="viewer-nav viewer-prev" onclick="editorPrevImage()">&#10094;</button>
        <img class="viewer-image" src="" alt="">
        <button class="viewer-nav viewer-next" onclick="editorNextImage()">&#10095;</button>
    </div>

    <script src="./frontend/js/utils.js"></script>
    <script src="./frontend/js/config.js"></script>
    <script src="./frontend/js/api.js"></script>
    <script src="./frontend/js/editor-page.js"></script>
    <script>
        // 页面初始化：从 URL 参数获取模式和批次 ID
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            const mode = params.get('mode') || 'new';
            const batchId = params.get('id');

            if (typeof loadEditorPage === 'function') {
                await loadEditorPage(mode, batchId);
            }
        });
    </script>
</body>
</html>
